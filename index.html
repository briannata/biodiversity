<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <title>Biodiversity Viz</title>

  <!-- Load d3.js and the geo projection plugin -->
  <script src="https://d3js.org/d3.v6.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

  <!-- Google font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">

  <!-- Vega Embed -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-lite@5.16.3"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

</head>
<body>
  <h1>Biodiversity Visualizations Dashboard</h1>
  <!-- Add a slider -->
  <p id="year">Year: 1950</p>
  <input type="range" name="yearSlider" id=yearSlider min="1950" max="2020" value="1950">
    <!-- Button -->
  <div>
    <input type="checkbox" id="act" class="checkbox" value="Actinopteri" checked><label>Actinopteri</label>
    <input type="checkbox" id="amp" class="checkbox" value="Amphibia" checked><label>Amphibia</label>
    <input type="checkbox" id="aves" class="checkbox" value="Aves" checked><label>Aves</label>
    <input type="checkbox" id="dip" class="checkbox" value="Dipneusti" checked><label>Dipneusti</label>
    <input type="checkbox" id="ela" class="checkbox" value="Elasmobranchii" checked><label>Elasmobranchii</label>
    <input type="checkbox" id="holo" class="checkbox" value="Holocephali" checked><label>Holocephali</label>
    <input type="checkbox" id="mam" class="checkbox" value="Mammalia" checked><label>Mammalia</label>
    <input type="checkbox" id="myx" class="checkbox" value="Myxini" checked><label>Myxini</label>
    <input type="checkbox" id="pet" class="checkbox" value="Petromyzonti" checked><label>Petromyzonti</label>
    <input type="checkbox" id="rep" class="checkbox" value="Repitalia" checked><label>Repitalia</label>
  </div>
  <svg id="viz1" width="630" height="350"></svg>
  <svg id="viz2" width="630" height="350"></svg>
  <script>
    // This is the default value
    var selectedColumn = "1950";

    d3.select("#yearSlider").on("change", function(d){
      selectedColumn = this.value
      document.getElementById('year').innerHTML = "Year: " + selectedColumn;
      showData();
    })

    // The svg for visualization 1
    var svg1 = d3.select("#viz1"),
        width = +svg1.attr("width"),
        height = +svg1.attr("height");

    // The svg for visualization 2
    var svg2 = d3.select('#viz2'),
      width = +svg2.attr("width"),
      height = +svg2.attr("height");

    d3.json("world.geojson", function(d) {
      return d
    }).then(function(dataGeo) {
      // Draw the map
      svg1.append("g")
          .selectAll("path")
          .data(dataGeo.features)
          .enter()
          .append("path")
            .attr("fill", "#b8b8b8")
            .attr("d", d3.geoPath()
                .projection(projection)
            )
          .style("stroke", "none")
          .style("opacity", .3)
    })

    // Add title and explanation
    svg1.append("text")
          .attr("text-anchor", "end")
          .style("fill", "black")
          .attr("x", width - 10)
          .attr("y", height - 30)
          .attr("width", 90)
          .html("ANIMAL POPULATIONS OVER TIME")
          .style("font-size", 14)
    
    // Map and projection
    var projection = d3.geoMercator()
        .center([0,20])                // GPS of location to zoom on
        .scale(99)                       // This is like the zoom
        .translate([ width/2, height/2 ])

    function showData() {
      
      d3.csv("LPD2022_public.csv", function(d) {
        return {
          class: d["Class"],
          common_name: d["Common_name"],
          latitude: +d["Latitude"],
          longitude: +d["Longitude"],
          n: +d[selectedColumn]
      }
    }).then(function(data) {
      // Create a color scale
      var allClasses = ['Actinopteri', 'Amphibia', 'Aves', 'Dipneusti', 'Elasmobranchii', 'Holocephali', 'Mammalia', 'Myxini', 'Petromyzonti', 'Repitalia']
      const color = d3.scaleOrdinal()
                .domain(allClasses)
                .range(["#54478c","#2c699a","#048ba8","#0db39e","#16db93","#83e377","#b9e769","#efea5a","#f1c453","#f29e4c"])
    
      // Add a scale for bubble size
      var valueExtent = d3.extent(data, function(d) { return +d.n; })
      var size = d3.scaleSqrt()
        .domain(valueExtent)  // What's in the data
        .range([1, 50])  // Size in pixel

        // var tooltip = d3.select("#viz1")
        //             .append("div")
        //             .style("position", "absolute")
        //             .style("visibility", "hidden")

        var tip = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0)

      svg1.selectAll("circle").remove();
      // Add circles:
      svg1.selectAll("myCircles")
        .data(data.sort(function(a,b) { return +b.n - +a.n }).filter(function(d,i){ return i<1000 }))
        .enter()
        .append("circle")
          .attr("cx", function(d){ return projection([+d.longitude, +d.latitude])[0] })
          .attr("cy", function(d){ return projection([+d.longitude, +d.latitude])[1] })
          .attr("r", function(d){ return size(+d.n) })
          .style("fill", function(d) {
                return color(d.class)
            })
          .attr("stroke-width", 1)
          .attr("fill-opacity", .4)
          .attr("class" , function(d){ return d.class})
          .on("mouseover", function(d) {
            tip.style("opacity", 1)
              .html("Class: " + d.class + "<br/> Number: " + d.n)
              .style("left", "50px")
              .style("top", "50px")
            })
            .on("mouseout", function(d) {
              tip.style("opacity", 0)
            })
          // .on("mouseover", function(e, d) { 
          //       return tooltip.style("visibility", "visible")   
          //                       .html("Class: " + d.class)  
          //   })
          //   .on("mousemove", function(e, d) {
          //       return tooltip.style("top", d3.select(this)     
          //                                     .attr("cy")+"px") 
          //                     .style("left", d3.select(this)    
          //                                      .attr("cx")+"px")                                             
          //   })
          //   .on("mouseout", function(e, d) { 
          //       return tooltip.style("visibility", "hidden")                                    
          //   })
        .exit()

      
        // Add Y axis
        var y = d3.scaleLinear()
          .domain([0, 13000])
          .range([ height, 0]);
        svg2.append("g")
          .call(d3.axisLeft(y));

        // Bars
        svg2.selectAll("mybar")
          .data(data.sort(function(a,b) { return +b.n - +a.n }))
          .enter()
          .append("rect")
            .attr("x", function(d) { return x(d.class); })
            .attr("y", function(d) { return y(d.data); })
            .attr("width", x.bandwidth())
            .attr("height", function(d) { return height - y(d.data); })
            .attr("fill", "#69b3a2")
          
          })}

  // This function is gonna change the opacity of selected and unselected circles
  function update(){

  // For each check box:
  d3.selectAll(".checkbox").each(function(d){
    cb = d3.select(this);
    grp = cb.property("value")

    // If the box is check, I show the group
    if(cb.property("checked")){
      svg1.selectAll("."+grp).transition().duration(1000).style("opacity", 1)

    // Otherwise I hide it
    }else{
      svg1.selectAll("."+grp).transition().duration(1000).style("opacity", 0)
    }
  })
  }

  // When a button change, I run the update function
  d3.selectAll(".checkbox").on("change",update);

  // And I initialize it at the beginning
  update();

  showData();
    
    </script>
    <br><br><br>  
    <div class='tableauPlaceholder' id='viz1714098769094' style='position: relative'><noscript><a href='#'><img alt='Dashboard 1 ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Wi&#47;WildlifeBiodiversityfrom1960to2014&#47;Dashboard1&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='embed_code_version' value='3' /> <param name='site_root' value='' /><param name='name' value='WildlifeBiodiversityfrom1960to2014&#47;Dashboard1' /><param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Wi&#47;WildlifeBiodiversityfrom1960to2014&#47;Dashboard1&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /><param name='language' value='en-US' /></object></div>                <script type='text/javascript'>                    var divElement = document.getElementById('viz1714098769094');                    var vizElement = divElement.getElementsByTagName('object')[0];                    if ( divElement.offsetWidth > 800 ) { vizElement.style.width='1000px';vizElement.style.height='827px';} else if ( divElement.offsetWidth > 500 ) { vizElement.style.width='1000px';vizElement.style.height='827px';} else { vizElement.style.width='100%';vizElement.style.height='827px';}                     var scriptElement = document.createElement('script');                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                </script>
<br><br><br>
    <div class='tableauPlaceholder' id='viz1714098313307' style='position: relative'><noscript><a href='#'><img alt='Dashboard 1 ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ho&#47;HowWildlifePopulationsareChanging_17140607921500&#47;Dashboard1&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='embed_code_version' value='3' /> <param name='site_root' value='' /><param name='name' value='HowWildlifePopulationsareChanging_17140607921500&#47;Dashboard1' /><param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ho&#47;HowWildlifePopulationsareChanging_17140607921500&#47;Dashboard1&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /><param name='language' value='en-US' /></object></div>                <script type='text/javascript'>                    var divElement = document.getElementById('viz1714098313307');                    var vizElement = divElement.getElementsByTagName('object')[0];                    if ( divElement.offsetWidth > 800 ) { vizElement.style.width='1000px';vizElement.style.height='827px';} else if ( divElement.offsetWidth > 500 ) { vizElement.style.width='1000px';vizElement.style.height='827px';} else { vizElement.style.width='100%';vizElement.style.height='727px';}                     var scriptElement = document.createElement('script');                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                </script>
<br><br><br>


  <div id="vis1"></div>
  <script>
    (function(vegaEmbed) {
      var spec = {"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-b1831b3724e537e5c03e3b2ce1977960"}, "mark": {"type": "bar"}, "encoding": {"color": {"field": "Proportion of average relative change in size of populations", "scale": {"scheme": "greenblue"}, "type": "quantitative"}, "x": {"axis": {"format": "%"}, "field": "Proportion of average relative change in size of populations", "scale": {"type": "log"}, "title": "Percent average relative change in size of populations", "type": "quantitative"}, "y": {"field": "Common Name", "sort": "-x", "type": "nominal"}}, "height": 500, "title": "Top 20 Animals in the World with Greatest Increase in Population", "width": 400, "$schema": "https://vega.github.io/schema/vega-lite/v5.16.3.json", "datasets": {"data-b1831b3724e537e5c03e3b2ce1977960": [{"Common Name": "American plaice", "Proportion of average relative change in size of populations": 976930.9108565}, {"Common Name": "Silver hake / Whiting", "Proportion of average relative change in size of populations": 422159.4913418043}, {"Common Name": "American eel", "Proportion of average relative change in size of populations": 40527.0}, {"Common Name": "Dunlin", "Proportion of average relative change in size of populations": 30995.3}, {"Common Name": "Capelin", "Proportion of average relative change in size of populations": 12848.4110304}, {"Common Name": "Chub mackerel", "Proportion of average relative change in size of populations": 10138.79365079365}, {"Common Name": "Atlantic halibut", "Proportion of average relative change in size of populations": 6612.344849877519}, {"Common Name": "European sprat", "Proportion of average relative change in size of populations": 4651.217741935484}, {"Common Name": "Atlantic mackerel", "Proportion of average relative change in size of populations": 2840.0742433809087}, {"Common Name": "Eurasian oystercatcher", "Proportion of average relative change in size of populations": 543.1280034675325}, {"Common Name": "Stoat / Short-tailed weasel / Ermine", "Proportion of average relative change in size of populations": 468.99999999999994}, {"Common Name": "Black-tailed godwit", "Proportion of average relative change in size of populations": 392.0517906714286}, {"Common Name": "Moose", "Proportion of average relative change in size of populations": 367.74435590969455}, {"Common Name": "European eel", "Proportion of average relative change in size of populations": 363.4866666666666}, {"Common Name": "Sea lamprey", "Proportion of average relative change in size of populations": 355.8228105906313}, {"Common Name": "Chimpanzee", "Proportion of average relative change in size of populations": 293.28571428571433}, {"Common Name": "Haddock", "Proportion of average relative change in size of populations": 247.85189068491349}, {"Common Name": "Long-tailed tit", "Proportion of average relative change in size of populations": 166.555621}, {"Common Name": "Ruddy turnstone", "Proportion of average relative change in size of populations": 160.40526315789472}, {"Common Name": "Common pheasant", "Proportion of average relative change in size of populations": 157.881926}]}};
      var embedOpt = {"mode": "vega-lite"};

      function showError(el, error){
          el.innerHTML = ('<div style="color:red;">'
                          + '<p>JavaScript Error: ' + error.message + '</p>'
                          + "<p>This usually means there's a typo in your chart specification. "
                          + "See the javascript console for the full traceback.</p>"
                          + '</div>');
          throw error;
      }
      const el = document.getElementById('vis1');
      vegaEmbed("#vis1", spec, embedOpt)
        .catch(error => showError(el, error));
    })(vegaEmbed);

  </script>

<br><br><br>

  <div id="vis2"></div>
  <script>
    (function(vegaEmbed) {
      var spec = {"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-961b5961c43ee9b9ac774ff5ed6882ca"}, "mark": {"type": "bar"}, "encoding": {"color": {"field": "Proportion of average relative change in size of populations", "scale": {"scheme": "purpleblue", "reverse": true}, "type": "quantitative"}, "x": {"axis": {"format": "%"}, "field": "Proportion of average relative change in size of populations", "scale": {"domain": [0, -1]}, "title": "Percent average relative change in size of populations", "type": "quantitative"}, "y": {"field": "Order", "sort": "x", "type": "nominal"}}, "height": 500, "title": "Top 20 Orders in the World with Greatest Decrease in Population", "width": 400, "$schema": "https://vega.github.io/schema/vega-lite/v5.16.3.json", "datasets": {"data-961b5961c43ee9b9ac774ff5ed6882ca": [{"Order": "Aulopiformes", "Proportion of average relative change in size of populations": -1.0}, {"Order": "Procellariformes", "Proportion of average relative change in size of populations": -1.0}, {"Order": "Pterocliformes", "Proportion of average relative change in size of populations": -1.0}, {"Order": "Rhinopristiformes", "Proportion of average relative change in size of populations": -1.0}, {"Order": "Istiophoriformes", "Proportion of average relative change in size of populations": -1.0}, {"Order": "Acropomatiformes", "Proportion of average relative change in size of populations": -0.999755614580453}, {"Order": "Perissodactyla", "Proportion of average relative change in size of populations": -0.999752859135286}, {"Order": "Esociformes", "Proportion of average relative change in size of populations": -0.9951727272727273}, {"Order": "Centrarchiformes", "Proportion of average relative change in size of populations": -0.993533004069296}, {"Order": "Anseriformes", "Proportion of average relative change in size of populations": -0.9790027361495143}, {"Order": "Carnivora", "Proportion of average relative change in size of populations": -0.9710624656572262}, {"Order": "Gruiformes", "Proportion of average relative change in size of populations": -0.949687720318899}, {"Order": "Trachichthyiformes", "Proportion of average relative change in size of populations": -0.885593220338983}, {"Order": "Rodentia", "Proportion of average relative change in size of populations": -0.7702424773679335}, {"Order": "Perciformes", "Proportion of average relative change in size of populations": -0.5891216227198747}, {"Order": "Testudines", "Proportion of average relative change in size of populations": -0.4784343246753247}, {"Order": "Strigiformes", "Proportion of average relative change in size of populations": -0.4775844806007509}]}};
      var embedOpt = {"mode": "vega-lite"};

      function showError(el, error){
          el.innerHTML = ('<div style="color:red;">'
                          + '<p>JavaScript Error: ' + error.message + '</p>'
                          + "<p>This usually means there's a typo in your chart specification. "
                          + "See the javascript console for the full traceback.</p>"
                          + '</div>');
          throw error;
      }
      const el = document.getElementById('vis2');
      vegaEmbed("#vis2", spec, embedOpt)
        .catch(error => showError(el, error));
    })(vegaEmbed);

  </script>

<br><br><br>

<div id="viz5"></div>
<script>
  (function(vegaEmbed) {
    var spec = {"$schema": "https://vega.github.io/schema/vega/v5.json", "data": [{"name": "param_1_store"}, {"name": "source_0", "values": [{"Legend": "Populations", "Number": 258, "Years": "1950-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 240, "Years": "1951-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 281, "Years": "1952-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 277, "Years": "1953-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 294, "Years": "1954-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 316, "Years": "1955-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 365, "Years": "1956-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 334, "Years": "1957-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 380, "Years": "1958-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 425, "Years": "1959-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 598, "Years": "1960-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 648, "Years": "1961-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 660, "Years": "1962-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 689, "Years": "1963-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 748, "Years": "1964-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 857, "Years": "1965-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 872, "Years": "1966-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 1036, "Years": "1967-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 1066, "Years": "1968-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 1116, "Years": "1969-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 3457, "Years": "1970-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 3332, "Years": "1971-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 3494, "Years": "1972-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 3890, "Years": "1973-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 4180, "Years": "1974-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 4471, "Years": "1975-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 4449, "Years": "1976-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 4740, "Years": "1977-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 4985, "Years": "1978-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 5125, "Years": "1979-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 5529, "Years": "1980-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 5937, "Years": "1981-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 6014, "Years": "1982-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 6385, "Years": "1983-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 6748, "Years": "1984-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 6964, "Years": "1985-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 6959, "Years": "1986-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 7434, "Years": "1987-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 7298, "Years": "1988-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 7509, "Years": "1989-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 8114, "Years": "1990-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 8201, "Years": "1991-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 9109, "Years": "1992-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 9551, "Years": "1993-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 9682, "Years": "1994-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 10151, "Years": "1995-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 9600, "Years": "1996-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 10598, "Years": "1997-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 10540, "Years": "1998-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 10163, "Years": "1999-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 10868, "Years": "2000-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 10450, "Years": "2001-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 10650, "Years": "2002-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 10358, "Years": "2003-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 10286, "Years": "2004-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 10553, "Years": "2005-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 9867, "Years": "2006-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 9569, "Years": "2007-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 9810, "Years": "2008-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 9895, "Years": "2009-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 11106, "Years": "2010-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 11564, "Years": "2011-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 10749, "Years": "2012-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 9776, "Years": "2013-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 9822, "Years": "2014-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 7008, "Years": "2015-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 6518, "Years": "2016-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 5400, "Years": "2017-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 2428, "Years": "2018-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 2159, "Years": "2019-01-01T00:00:00.000"}, {"Legend": "Populations", "Number": 1139, "Years": "2020-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 166, "Years": "1950-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 149, "Years": "1951-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 169, "Years": "1952-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 171, "Years": "1953-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 181, "Years": "1954-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 192, "Years": "1955-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 216, "Years": "1956-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 191, "Years": "1957-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 227, "Years": "1958-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 255, "Years": "1959-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 314, "Years": "1960-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 320, "Years": "1961-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 347, "Years": "1962-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 359, "Years": "1963-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 366, "Years": "1964-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 412, "Years": "1965-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 417, "Years": "1966-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 503, "Years": "1967-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 490, "Years": "1968-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 519, "Years": "1969-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 899, "Years": "1970-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 879, "Years": "1971-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 902, "Years": "1972-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 959, "Years": "1973-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1029, "Years": "1974-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1091, "Years": "1975-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1117, "Years": "1976-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1145, "Years": "1977-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1197, "Years": "1978-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1243, "Years": "1979-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1306, "Years": "1980-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1311, "Years": "1981-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1346, "Years": "1982-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1379, "Years": "1983-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1415, "Years": "1984-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1471, "Years": "1985-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1488, "Years": "1986-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1678, "Years": "1987-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1534, "Years": "1988-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1603, "Years": "1989-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1625, "Years": "1990-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1725, "Years": "1991-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 2012, "Years": "1992-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1832, "Years": "1993-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1867, "Years": "1994-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1983, "Years": "1995-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1931, "Years": "1996-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 2208, "Years": "1997-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 2128, "Years": "1998-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 2037, "Years": "1999-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 2255, "Years": "2000-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 2227, "Years": "2001-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 2161, "Years": "2002-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 2186, "Years": "2003-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 2217, "Years": "2004-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 2297, "Years": "2005-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 2010, "Years": "2006-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1930, "Years": "2007-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1873, "Years": "2008-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1844, "Years": "2009-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 2021, "Years": "2010-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1972, "Years": "2011-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1874, "Years": "2012-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1592, "Years": "2013-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1503, "Years": "2014-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1143, "Years": "2015-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 1069, "Years": "2016-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 721, "Years": "2017-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 597, "Years": "2018-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 499, "Years": "2019-01-01T00:00:00.000"}, {"Legend": "Species", "Number": 280, "Years": "2020-01-01T00:00:00.000"}], "transform": [{"type": "formula", "expr": "toDate(datum['Years'])", "as": "Years"}]}, {"name": "data_0", "values": [], "transform": [{"type": "formula", "expr": "toDate(datum['Years'])", "as": "Years"}]}, {"name": "source_0_color_domain_Legend_0", "values": [{"Legend": "Populations"}, {"Legend": "Species"}]}, {"name": "data_0_color_domain_Legend_1", "values": []}], "signals": [{"name": "unit", "value": {}, "on": [{"events": "pointermove", "update": "isTuple(group()) ? group() : unit"}]}, {"name": "param_1", "update": "vlSelectionResolve(\"param_1_store\", \"union\")"}, {"name": "param_1_Years", "on": [{"events": [{"source": "view", "type": "dblclick"}], "update": "null"}, {"events": {"signal": "param_1_translate_delta"}, "update": "panLinear(param_1_translate_anchor.extent_x, -param_1_translate_delta.x / width)"}, {"events": {"signal": "param_1_zoom_delta"}, "update": "zoomLinear(domain(\"x\"), param_1_zoom_anchor.x, param_1_zoom_delta)"}]}, {"name": "param_1_data", "on": [{"events": [{"source": "view", "type": "dblclick"}], "update": "null"}, {"events": {"signal": "param_1_translate_delta"}, "update": "panLinear(param_1_translate_anchor.extent_y, param_1_translate_delta.y / height)"}, {"events": {"signal": "param_1_zoom_delta"}, "update": "zoomLinear(domain(\"y\"), param_1_zoom_anchor.y, param_1_zoom_delta)"}]}, {"name": "param_1_tuple", "on": [{"events": [{"signal": "param_1_Years || param_1_data"}], "update": "param_1_Years && param_1_data ? {unit: \"layer_0\", fields: param_1_tuple_fields, values: [param_1_Years,param_1_data]} : null"}]}, {"name": "param_1_tuple_fields", "value": [{"field": "Years", "channel": "x", "type": "R"}, {"field": "data", "channel": "y", "type": "R"}]}, {"name": "param_1_translate_anchor", "value": {}, "on": [{"events": [{"source": "scope", "type": "pointerdown"}], "update": "{x: x(unit), y: y(unit), extent_x: domain(\"x\"), extent_y: domain(\"y\")}"}]}, {"name": "param_1_translate_delta", "value": {}, "on": [{"events": [{"source": "window", "between": [{"source": "scope", "type": "pointerdown"}, {"source": "window", "type": "pointerup"}], "type": "pointermove", "consume": true}], "update": "{x: param_1_translate_anchor.x - x(unit), y: param_1_translate_anchor.y - y(unit)}"}]}, {"name": "param_1_zoom_anchor", "on": [{"events": [{"source": "scope", "consume": true, "type": "wheel"}], "update": "{x: invert(\"x\", x(unit)), y: invert(\"y\", y(unit))}"}]}, {"name": "param_1_zoom_delta", "on": [{"events": [{"source": "scope", "type": "wheel", "consume": true}], "update": "pow(1.001, event.deltaY * pow(16, event.deltaMode))", "force": true}]}, {"name": "param_1_modify", "on": [{"events": {"signal": "param_1_tuple"}, "update": "modify(\"param_1_store\", param_1_tuple, true)"}]}], "marks": [{"type": "group", "name": "layer_0_pathgroup", "from": {"facet": {"data": "source_0", "name": "faceted_path_layer_0_main", "groupby": ["Legend"]}}, "encode": {"update": {"width": {"field": {"signal": null, "datum": null, "group": "width", "parent": null}}, "height": {"field": {"signal": null, "datum": null, "group": "height", "parent": null}}}}, "marks": [{"type": "line", "name": "layer_0_marks", "from": {"data": "faceted_path_layer_0_main"}, "sort": {"field": "datum[\"Years\"]"}, "encode": {"update": {"tooltip": {"signal": "{\"Years\": timeFormat(datum[\"Years\"], '%b %d, %Y'), \"Number\": format(datum[\"Number\"], \"\")}"}, "stroke": {"field": "Legend", "scale": "color"}, "x": {"field": "Years", "scale": "x"}, "y": {"field": "data", "scale": "y"}, "defined": {"signal": "isValid(datum[\"Years\"]) && isFinite(+datum[\"Years\"]) && isValid(datum[\"data\"]) && isFinite(+datum[\"data\"])"}}}, "interactive": true, "clip": true, "style": ["line"]}]}, {"type": "symbol", "name": "layer_1_marks", "from": {"data": "data_0"}, "encode": {"update": {"fill": {"field": "Legend", "scale": "color"}, "x": {"field": "Years", "scale": "x"}, "tooltip": {"signal": "{\"Years\": timeFormat(datum[\"Years\"], '%b %d, %Y'), \"Number\": format(datum[\"Number\"], \"\")}"}, "y": {"field": "data", "scale": "y"}, "opacity": {"value": 1}}}, "interactive": true, "style": ["point"], "clip": true}], "scales": [{"name": "x", "type": "time", "domain": {"fields": [{"data": "source_0", "field": "Years"}, {"data": "data_0", "field": "Years"}]}, "range": [0, {"signal": "width"}], "domainRaw": {"signal": "param_1[\"Years\"]"}}, {"name": "y", "type": "linear", "domain": {"fields": [{"data": "source_0", "field": "data"}, {"data": "data_0", "field": "data"}]}, "range": [{"signal": "height"}, 0], "domainRaw": {"signal": "param_1[\"data\"]"}, "nice": true, "zero": true}, {"name": "color", "type": "ordinal", "domain": {"fields": [{"data": "source_0_color_domain_Legend_0", "field": "Legend"}, {"data": "data_0_color_domain_Legend_1", "field": "Legend"}], "sort": true}, "range": "category"}], "axes": [{"scale": "x", "gridScale": "y", "ticks": false, "tickCount": {"signal": "ceil(width/40)"}, "domain": false, "maxExtent": 0, "orient": "bottom", "grid": true, "aria": false, "minExtent": 0, "labels": false, "zindex": 0}, {"scale": "y", "ticks": false, "zindex": 0, "domain": false, "orient": "left", "labels": false, "grid": true, "gridScale": "x", "tickCount": {"signal": "ceil(height/40)"}, "minExtent": 0, "aria": false, "maxExtent": 0}, {"scale": "x", "title": "Years", "orient": "bottom", "grid": false, "labelFlush": true, "labelOverlap": true, "zindex": 0, "tickCount": {"signal": "ceil(width/40)"}}, {"scale": "y", "tickCount": {"signal": "ceil(height/40)"}, "grid": false, "labelOverlap": true, "zindex": 0, "orient": "left", "title": "Number"}], "title": {"text": "Number of Populations and Species Over Time", "frame": "group"}, "style": "cell", "legends": [{"stroke": "color", "symbolType": "circle", "title": "Legend", "fill": "color", "encode": {"symbols": {"update": {"opacity": {"value": 1}}}}}], "height": 300, "padding": 5, "width": 300, "background": "white"};
    var embedOpt = {"mode": "vega"};

    function showError(el, error){
        el.innerHTML = ('<div style="color:red;">'
                        + '<p>JavaScript Error: ' + error.message + '</p>'
                        + "<p>This usually means there's a typo in your chart specification. "
                        + "See the javascript console for the full traceback.</p>"
                        + '</div>');
        throw error;
    }
    const el = document.getElementById('vis5');
    vegaEmbed("#vis5", spec, embedOpt)
      .catch(error => showError(el, error));
  })(vegaEmbed);

</script>
</body>
</html>